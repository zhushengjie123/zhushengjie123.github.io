(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{416:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"初识-vite-基础知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初识-vite-基础知识"}},[s._v("#")]),s._v(" 初识 Vite 基础知识")]),s._v(" "),t("p",[s._v("vite 特点：")]),s._v(" "),t("ol",[t("li",[s._v("快速的冷启动")]),s._v(" "),t("li",[s._v("即时的模块热更新")]),s._v(" "),t("li",[s._v("真正的按需编译")])]),s._v(" "),t("p",[s._v("vite 主要特点是基于浏览器 native 的 "),t("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import",target:"_blank",rel:"noopener noreferrer"}},[s._v("ES module"),t("OutboundLink")],1),s._v(" 来开发，省略打包这个步骤，因为需要什么资源直接在浏览器里引入即可。")]),s._v(" "),t("p",[s._v("vite 开发环境利用浏览器的 import 机制，打包时也有内置的 rollup ，所以可以直接使用。")]),s._v(" "),t("blockquote",[t("p",[s._v("这里主要还是了解一下 "),t("code",[s._v("rollup")]),s._v(" 和 "),t("code",[s._v("webpack")]),s._v(" 的区别，"),t("code",[s._v("rollup")]),s._v(" 的模块打包能力并没有 "),t("code",[s._v("webpack")]),s._v(" 强大，但是利用了 "),t("code",[s._v("tree-shaking")]),s._v(" 充分处理 "),t("code",[s._v("js")]),s._v(" 文件，打包出来的 "),t("code",[s._v("js")]),s._v(" 文件会比较 “干净”。")])]),s._v(" "),t("h2",{attrs:{id:"vite使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite使用"}},[s._v("#")]),s._v(" Vite使用")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v("  create vite-app "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("project-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("blockquote",[t("p",[t("code",[s._v("npm create")]),s._v(" 其实就是 "),t("code",[s._v("npm init")]),s._v(" 命令，而 "),t("code",[s._v("npm init")]),s._v(" 命令带上包名执行的就是 "),t("code",[s._v("npm exec")]),s._v("，也就是执行 "),t("code",[s._v("vite")]),s._v(" 包的默认命令 —— "),t("code",[s._v("初始化")]),s._v("。")])]),s._v(" "),t("p",[s._v("Vite项目结构树")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("➜  vite-app tree\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n├── index.html  // 页面入口,注意是在项目最外层\n├── vite.config.js // 配置文件\n├── package.json\n├── public\n│   └── favicon.ico\n└── src\n    ├── App.vue\n    ├── assets\n    │   └── logo.png\n    ├── components\n    │   └── HelloWorld.vue\n    ├── index.css\n    └── main.js\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"vite-解决了-webpack-哪些问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vite-解决了-webpack-哪些问题"}},[s._v("#")]),s._v(" Vite 解决了 Webpack 哪些问题")]),s._v(" "),t("p",[t("em",[s._v("本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器（module bundler）")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zhushengjie123/image-store/PicGo/202206272305895.png",alt:"5Fsdsd179FE8104D"}})]),s._v(" "),t("p",[s._v("Vue 脚手架工具 vue-cli 使用 webpack 进行打包，开发时可以启动本地开发服务器，实时预览。因为需要对整个项目文件进行打包，开发服务器启动缓慢。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zhushengjie123/image-store/PicGo/202206272305949.png",alt:"5F12312e179FE8104D"}})]),s._v(" "),t("p",[s._v("而对于开发时文件修改后的热更新 HMR 也存在同样的问题。Webpack 的热更新会以当前修改的文件为入口重新 build 打包，所有涉及到的依赖也都会被重新加载一次。")]),s._v(" "),t("p",[s._v("Vite 则很好地解决了上面的两个问题。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zhushengjie123/image-store/PicGo/202206272306423.png",alt:"123123RR179FE8104D"}})]),s._v(" "),t("h3",{attrs:{id:"打包问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包问题"}},[s._v("#")]),s._v(" 打包问题")]),s._v(" "),t("p",[s._v("vite 只启动一台静态页面的服务器，对文件代码不打包，服务器会根据客户端的请求加载不同的模块处理，实现真正的按需加载。\n"),t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zhushengjie123/image-store/PicGo/202206272306192.png",alt:"QWEQWE123FE8104D"}})]),s._v(" "),t("h2",{attrs:{id:"plugin"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#plugin"}},[s._v("#")]),s._v(" plugin")]),s._v(" "),t("p",[s._v("vite 背后的原理都在 plugin 里。")]),s._v(" "),t("p",[s._v("plugin大致分类如下")]),s._v(" "),t("ul",[t("li",[s._v("用户注入的 plugins —— 自定义 plugin")]),s._v(" "),t("li",[s._v("hmrPlugin —— 处理 hmr")]),s._v(" "),t("li",[s._v("htmlRewritePlugin —— 重写 html 内的 script 内容")]),s._v(" "),t("li",[s._v("moduleRewritePlugin —— 重写模块中的 import 导入")]),s._v(" "),t("li",[s._v("moduleResolvePlugin ——获取模块内容")]),s._v(" "),t("li",[s._v("vuePlugin —— 处理 vue 单文件组件")]),s._v(" "),t("li",[s._v("esbuildPlugin —— 使用 esbuild 处理资源")]),s._v(" "),t("li",[s._v("assetPathPlugin —— 处理静态资源")]),s._v(" "),t("li",[s._v("serveStaticPlugin —— 托管静态资源")]),s._v(" "),t("li",[s._v("cssPlugin —— 处理 css/less/sass 等引用")])]),s._v(" "),t("p",[s._v("接下来看看 plugin 的实现方式，开发一个用来拦截 json 文件 plugin 可以这么实现")]),s._v(" "),t("div",{staticClass:"language-tsx line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-tsx"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerPluginContext")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\troot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n\tapp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Koa\n\tserver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Server\n\twatcher"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" HMRWatcher\n\tresolver"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" InternalResolver\n\tconfig"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ServerConfig\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServerPlugin")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("（ctx")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("ServerPluginContext）"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" JsonInterceptPlugin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("ServerPlugin")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" next"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("next")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("endsWith")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.json'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'js'")]),s._v("\n\t\t\tctx"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("body "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'export default json'")]),s._v("\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);